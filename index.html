<!DOCTYPE html>
<html lang="en" style="font-family: aptos;">
<head>
  <meta charset="UTF-8">
  <title>4cast Weather</title>

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/weather-icons.css">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root { font-size:16px; }

    @font-face { font-family: aptos; src: url(/4cast/assets/aptos.ttf) format('truetype'); }
    @font-face { font-family: aptosBold; src: url(/4cast/assets/aptosBold.ttf) format('truetype'); }

    #header {
      position: fixed; top:0; left:0; right:0; z-index:100;
      font-size: clamp(0.1rem,10vw,10rem);
      font-family: 'Dancing Script', cursive;
      background-color: cornflowerblue;
      padding:1vh 5vw 0.5vh 2.5vw;
      display:grid; grid-template-columns:auto auto;
    }

    #location { text-align:right; align-self:end; font-family:aptosBold; font-size:clamp(0.1rem,5vw,10rem);} 

    #scroll {
      padding-top: clamp(5rem,15vw,15rem); /* Blank space to allow for header */
      min-height: 100vh; background: linear-gradient(to bottom, cornflowerblue, white); /* responsive Sky Colour */
    }

    #current {
      display:grid;
      grid-template-columns:20vw 1.75fr 1.5fr 9vw 9vw;
      font-size:clamp(0.1rem,4vw,10rem);
      white-space:nowrap;
      padding:1vh 3vw;
    }

    #current > .iconCurrent { grid-column:1; grid-row:1 / span 3; }
    #current > .today { grid-column:2; grid-row:1; }
    #current > div:nth-child(3) { grid-column:2; grid-row:2; }
    #current > .precis { grid-column:2 / span 2; grid-row:3; }
    #current > div:nth-child(5) { grid-column:3; grid-row:2; }
    #current > .feels { grid-column:3; grid-row:1; }
    #current > div:nth-child(7) { grid-column:4; grid-row:1 / span 3; }
    #current > div:nth-child(8) { grid-column:5; grid-row:1 / span 3; }

    .forecast-day {
      display: grid;
      grid-template-columns: 13vw 3fr 9vw 9vw;
      font-size: clamp(0.1rem, 4vw, 10rem);
      white-space: nowrap;
      padding:1vh 3vw;
    }

    .forecast-day > .icon { grid-column: 1; grid-row: 1 / span 2; }
    .forecast-day > .date { grid-column: 2; grid-row: 1; }
    .forecast-day > .precis { grid-column: 2; grid-row: 2; }
    .forecast-day > .min-temp { grid-column: 3; grid-row: 1 / span 2; }
    .forecast-day > .max-temp { grid-column: 4; grid-row: 1 / span 2; }


    .icon { font-size:clamp(0.1rem,7vw,10rem); align-self:center; padding-top:1.25vh; }
    .iconCurrent { font-size:clamp(0.1rem,13vw,10rem); align-self:center; padding-top:1vh;}

    .update { font-size:clamp(0.1rem,2vw,10rem); text-align:right; color:#555; }
    .feels { font-size:clamp(0.1rem,2vw,10rem); text-align:left; color:#555; align-self: end;} /* "end" = bottom-align within this grid row */

    #tempObs { font-size:clamp(0.1rem,5vw,10rem); font-weight:bold; }
    #tempApp { font-size:clamp(0.1rem,4vw,10rem); font-weight:bold; }

    .min-temp {
      background-color: cornflowerblue;
      color: black;
      border-radius: 0.5pc 0 0 0.5pc;
      align-self: center;
      text-align: center;
      padding: 0.75vh;
      margin-top: 0vw;
    }

    .max-temp {
      background-color: red;
      color: white;
      border-radius: 0 0.5pc 0.5pc 0;
      align-self: center;
      text-align: center;
      padding: 0.75vh;
      margin-top: 0vw;
    }

    .precis {
      font-size:clamp(0.1rem,3vw,10rem);
      padding-left:1vw;
      color:#555;
      white-space: normal;       /* allow wrapping */
      word-wrap: break-word;     /* wrap long words if needed */
    }

  </style>
</head>

<body>
  <div id="header">4cast
    <div id="location">Noarlunga
      <div id="updated" class="update"></div>
    </div>
  </div>

  <div id="scroll">
    <!-- CURRENT WEATHER -->
    <div id="current">
      <div id="forecast-day0-icon" class="iconCurrent">--</div>
      <div id="today">Loading date...</div>
      <div id="tempObs">Loading...</div>
      <div id="forecast-day0-cloud" class="precis">Loading...</div>
      <div id="tempApp">Loading...</div>
      <div class="feels">Feels like</div>
      <div id="forecast-day0-min" class="min-temp">--</div>
      <div id="forecast-day0-max" class="max-temp">--</div>
    </div>

    <hr>

    <!-- FORECAST DAYS -->
    <div id="forecast-container">
      <!-- Repeat for 6 days -->
      <div class="forecast-day" id="forecast-day1">
        <div id="forecast-day1-icon" class="icon">--</div>
        <div id="forecast-day1-date">Loading...</div>
        <div id="forecast-day1-cloud" class="precis">Loading...</div>
        <div id="forecast-day1-min" class="min-temp">--</div>
        <div id="forecast-day1-max" class="max-temp">--</div>
      </div>

    <hr>

      <div class="forecast-day" id="forecast-day2">
        <div id="forecast-day2-icon" class="icon">--</div>
        <div id="forecast-day2-date">Loading...</div>
        <div id="forecast-day2-cloud" class="precis">Loading...</div>
        <div id="forecast-day2-min" class="min-temp">--</div>
        <div id="forecast-day2-max" class="max-temp">--</div>
      </div>

    <hr>

      <div class="forecast-day" id="forecast-day3">
        <div id="forecast-day3-icon" class="icon">--</div>
        <div id="forecast-day3-date">Loading...</div>
        <div id="forecast-day3-cloud" class="precis">Loading...</div>
        <div id="forecast-day3-min" class="min-temp">--</div>
        <div id="forecast-day3-max" class="max-temp">--</div>
      </div>

    <hr>

      <div class="forecast-day" id="forecast-day4">
        <div id="forecast-day4-icon" class="icon">--</div>
        <div id="forecast-day4-date">Loading...</div>
        <div id="forecast-day4-cloud" class="precis">Loading...</div>
        <div id="forecast-day4-min" class="min-temp">--</div>
        <div id="forecast-day4-max" class="max-temp">--</div>
      </div>

    <hr>

      <div class="forecast-day" id="forecast-day5">
        <div id="forecast-day5-icon" class="icon">--</div>
        <div id="forecast-day5-date">Loading...</div>
        <div id="forecast-day5-cloud" class="precis">Loading...</div>
        <div id="forecast-day5-min" class="min-temp">--</div>
        <div id="forecast-day5-max" class="max-temp">--</div>
      </div>

    <hr>

      <div class="forecast-day" id="forecast-day6">
        <div id="forecast-day6-icon" class="icon">--</div>
        <div id="forecast-day6-date">Loading...</div>
        <div id="forecast-day6-cloud" class="precis">Loading...</div>
        <div id="forecast-day6-min" class="min-temp">--</div>
        <div id="forecast-day6-max" class="max-temp">--</div>
      </div>
    </div>
    <hr>
  </div>


<script>

/* --- helpers & mappings --- */

function normalizePrecis(text) {
  return text
    .toLowerCase()
    .replace(/\./g, "")
    .trim();
}

const PRECIS_ICON_MAP = [
  // --- VERY SPECIFIC PHRASES FIRST ---

{ match: ["evening showers"],     icon: "wi-night-alt-showers" },
{ match: ["showers increasing"],  icon: "wi-showers" },
{ match: ["showers easing"],      icon: "wi-sleet" },
{ match: ["shower or two"],       icon: "wi-showers" },

{ match: ["rain developing"],     icon: "wi-rain" },
{ match: ["rain clearing"],       icon: "wi-rain" },
{ match: ["rain easing"],         icon: "wi-rain" },

{ match: ["cloud increasing"],    icon: "wi-day-cloudy" },

{ match: ["mostly sunny"],        icon: "wi-day-sunny-overcast" },
{ match: ["mostly cloudy"],       icon: "wi-day-cloudy" },
{ match: ["partly cloudy"],       icon: "wi-day-cloudy" },

{ match: ["mostly clear"],        icon: "wi-day-sunny-overcast" },
{ match: ["fog clearing"],        icon: "wi-day-haze" },
{ match: ["patchy fog"],          icon: "wi-cloudy-windy" },

{ match: ["smoke haze"],          icon: "wi-smoke" },
{ match: ["dust storm"],          icon: "wi-dust" },

{ match: ["very windy"],          icon: "wi-strong-wind" },
{ match: ["wind easing"],         icon: "wi-dust" },

// --- GENERAL WEATHER CONDITIONS ---

{ match: ["thunderstorms"],       icon: "wi-day-snow-thunderstorm" },
{ match: ["showers"],             icon: "wi-rain-mix" },
{ match: ["drizzle"],             icon: "wi-sleet" },
{ match: ["rain"],                icon: "wi-rain" },

{ match: ["hail"],                icon: "wi-hail" },

{ match: ["cloudy"],              icon: "wi-cloudy" },
{ match: ["sunny"],               icon: "wi-day-sunny" },

{ match: ["clearing"],            icon: "wi-night-alt-partly-cloudy" },
{ match: ["clear"],               icon: "wi-night-clear" },

{ match: ["gusty"],               icon: "wi-strong-wind" },
{ match: ["windy"],               icon: "wi-windy" },

{ match: ["fog"],                 icon: "wi-fog" },
{ match: ["haze"],                icon: "wi-day-haze" },

// --- TEMPERATURE / SECONDARY QUALIFIERS ---

{ match: ["icy"],                 icon: "wi-snowflake-cold" },
{ match: ["frost"],               icon: "wi-snowflake-cold" },
{ match: ["cold"],                icon: "wi-snowflake-cold" },

{ match: ["hot"],                 icon: "wi-hot" },
{ match: ["warm"],                icon: "wi-day-sunny" },
{ match: ["cool"],                icon: "wi-day-cloudy" },

];

const BOM_ICON_FALLBACK = {
  1: "wi-day-sunny",
  2: "wi-day-cloudy",
  3: "wi-cloudy",
  9: "wi-strong-wind"
};

/* --- icon resolver --- */

function getIcon(iconCode, precis) {
  if (precis) {
    const text = normalizePrecis(precis);

    for (const rule of PRECIS_ICON_MAP) {
      if (rule.match.some(k => text.includes(k))) {
        return `<i class="wi ${rule.icon}"></i>`;
      }
    }
  }

  if (iconCode && BOM_ICON_FALLBACK[iconCode]) {
    return `<i class="wi ${BOM_ICON_FALLBACK[iconCode]}"></i>`;
  }

  return `<i class="wi wi-na"></i>`;
}

async function loadWeather() {
  try {
    const res = await fetch("data/weather.json?t=" + new Date().getTime());
    const data = await res.json();

    // --- CURRENT WEATHER ---
    const current = data.current;
    document.getElementById("tempObs").textContent = current.air_temp.toFixed(1) + "°C";
    document.getElementById("tempApp").textContent = current.apparent_temp.toFixed(1) + "°C";
    document.getElementById("updated").textContent =
      "Updated: " + new Date(current.timestamp_local).toLocaleString('en-GB', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });   
    document.getElementById("today").textContent =
      new Date(current.timestamp_local).toLocaleDateString(undefined, { weekday: 'long', day:'numeric', month:'short' });

    // --- FORECAST ---
    data.forecast.forEach((day, i) => {
      const dateElem  = document.getElementById(`forecast-day${i}-date`);
      const minElem   = document.getElementById(`forecast-day${i}-min`);
      const maxElem   = document.getElementById(`forecast-day${i}-max`);
      const cloudElem = document.getElementById(`forecast-day${i}-cloud`);
      const iconElem  = document.getElementById(`forecast-day${i}-icon`);

      if (dateElem) {
        dateElem.textContent = new Date(day.date).toLocaleDateString(
          undefined,
          { weekday: 'long', day: 'numeric', month: 'short' }
        );
      }

      if (minElem) minElem.textContent = day.temp_min ?? "--";
      if (maxElem) maxElem.textContent = day.temp_max ?? "--";
      if (cloudElem) cloudElem.textContent = day.precis.replace(/\.$/, "");
      if (iconElem) iconElem.innerHTML = getIcon(day.icon, day.precis);

    });

  } catch(e) {
    console.error("Error loading weather:", e);
  }
}



loadWeather();
</script>
</body>



</html>